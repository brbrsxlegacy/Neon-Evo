<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NEON RISE CLEAN</title>
<style>
body { margin:0; background:#000; color:#0ff; overflow:hidden; font-family:Arial; }
canvas { display:block; }
#menu {
position:fixed; inset:0;
display:flex; flex-direction:column;
align-items:center; justify-content:center;
background:#000; z-index:10;
}
#hud { position:fixed; top:10px; left:10px; }
button { margin:5px; padding:6px 10px; }
</style>
</head>
<body>

<div id="menu">
<h1>NEON RISE</h1>
<button onclick="createRoom()">ODA OLUŞTUR</button>
<button onclick="joinRoom()">ODAYA GİR</button>
</div>

<div id="hud"></div>
<canvas id="game"></canvas>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<script>

/* =========================
   FIREBASE
========================= */

const firebaseConfig = {
apiKey: "AIzaSyABqkhpL1SMRzRJ9GQLjjZE2IryqpAvMPw",
authDomain: "pixelroom-ae218.firebaseapp.com",
databaseURL: "https://pixelroom-ae218-default-rtdb.europe-west1.firebasedatabase.app",
projectId: "pixelroom-ae218"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* =========================
   CORE STATE
========================= */

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const hud=document.getElementById("hud");

function resize(){
canvas.width=innerWidth;
canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

let currentRoom=null;
let playerId="p_"+Math.random().toString(36).substr(2,5);
let myRef=null;
let remotePlayers={};

let player={
x:0,y:0,
level:1,
hp:100,
maxHp:100,
xp:0,
xpToNext:100,
speed:3,
dashCooldown:0,
dashing:0,
spawnShield:0,
inventory:[],
equippedSkin:null,
clan:null
};

const skinPool=["#0ff","#f0f","#0f0","#ff0","#ff6600","#ffffff"];

/* =========================
   ROOM
========================= */

window.createRoom=function(){
const room="room_"+Math.random().toString(36).substr(2,4);
db.ref("rooms/"+room+"/meta").set({respawn:{x:0,y:0}});
connect(room);
}

window.joinRoom=function(){
db.ref("rooms").once("value").then(s=>{
const rooms=s.val()||{};
for(const r in rooms){
const count=rooms[r].players?Object.keys(rooms[r].players).length:0;
if(count<10){connect(r);return;}
}
alert("Boş oda yok");
});
}

function connect(room){
document.getElementById("menu").style.display="none";
currentRoom=room;
myRef=db.ref("rooms/"+room+"/players/"+playerId);
myRef.set(player);
myRef.onDisconnect().remove();
db.ref("rooms/"+room+"/players").on("value",s=>{
const data=s.val()||{};
remotePlayers={};
for(const id in data)
if(id!==playerId) remotePlayers[id]=data[id];
});
}

/* =========================
   INPUT
========================= */

let keys={};
onkeydown=e=>{
keys[e.key]=true;
if(e.key==="Shift") dash();
};
onkeyup=e=>keys[e.key]=false;

/* =========================
   SYSTEMS
========================= */

function dash(){
if(player.dashCooldown>0)return;
const p=120;
if(keys["w"])player.y-=p;
if(keys["s"])player.y+=p;
if(keys["a"])player.x-=p;
if(keys["d"])player.x+=p;
player.dashing=0.2;
player.dashCooldown=2;
}

function gainXP(a){
player.xp+=a;
if(player.xp>=player.xpToNext){
player.level++;
player.xp=0;
}
}

function respawn(){
player.hp=player.maxHp;
player.spawnShield=3;
}

function dealDamage(id){
const ref=db.ref("rooms/"+currentRoom+"/players/"+id);
ref.transaction(data=>{
if(!data)return;
data.hp=(data.hp||100)-25;
if(data.hp<=0){
player.level+=data.level||1;
data.level=1;
data.hp=100;
}
return data;
});
}

/* =========================
   BOSS
========================= */

let boss=null;
let bossTimer=0;

function spawnBoss(){
boss={x:player.x+300,y:player.y,hp:400,maxHp:400,size:40};
}

function updateBoss(){
if(!boss)return;
const dx=player.x-boss.x;
const dy=player.y-boss.y;
const d=Math.hypot(dx,dy);
if(d>5){boss.x+=dx/d*1.2;boss.y+=dy/d*1.2;}
if(d<50&&player.spawnShield<=0)player.hp-=0.4;
}

function damageBoss(){
if(!boss)return;
const d=Math.hypot(player.x-boss.x,player.y-boss.y);
if(d<60){
boss.hp-=20;
if(boss.hp<=0){
gainXP(50);
player.inventory.push(skinPool[Math.floor(Math.random()*skinPool.length)]);
boss=null;
}
}
}

/* =========================
   UPDATE
========================= */

function update(){

if(keys["w"])player.y-=player.speed;
if(keys["s"])player.y+=player.speed;
if(keys["a"])player.x-=player.speed;
if(keys["d"])player.x+=player.speed;

if(keys[" "]){
for(const id in remotePlayers){
const p=remotePlayers[id];
if(Math.hypot(player.x-p.x,player.y-p.y)<40&&player.spawnShield<=0)
dealDamage(id);
}
damageBoss();
}

if(player.hp<=0)respawn();

if(player.spawnShield>0)player.spawnShield-=1/60;
if(player.dashCooldown>0)player.dashCooldown-=1/60;
if(player.dashing>0)player.dashing-=1/60;

bossTimer+=1/60;
if(!boss && Object.keys(remotePlayers).length+1>=3 && bossTimer>30){
spawnBoss();
bossTimer=0;
}

updateBoss();

if(currentRoom)
myRef.set(player);

hud.innerHTML="HP:"+Math.floor(player.hp)+" | LV:"+player.level;
}

/* =========================
   DRAW
========================= */

function draw(){

ctx.fillStyle="#050510";
ctx.fillRect(0,0,canvas.width,canvas.height);

// grid
ctx.strokeStyle="rgba(0,255,255,0.08)";
for(let x=-(player.x%60);x<canvas.width;x+=60){
ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,canvas.height);ctx.stroke();
}
for(let y=-(player.y%60);y<canvas.height;y+=60){
ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(canvas.width,y);ctx.stroke();
}

// player
ctx.save();
ctx.translate(canvas.width/2,canvas.height/2);
ctx.shadowBlur=25;
ctx.shadowColor=player.equippedSkin||"#0ff";
ctx.fillStyle=player.equippedSkin||"#0ff";
ctx.beginPath();ctx.arc(0,0,18,0,Math.PI*2);ctx.fill();
ctx.restore();

// remote
for(const id in remotePlayers){
const p=remotePlayers[id];
ctx.save();
ctx.translate(canvas.width/2+(p.x-player.x),canvas.height/2+(p.y-player.y));
ctx.fillStyle="#f0f";
ctx.beginPath();ctx.arc(0,0,15,0,Math.PI*2);ctx.fill();
ctx.restore();
}

// boss
if(boss){
ctx.save();
ctx.translate(canvas.width/2+(boss.x-player.x),canvas.height/2+(boss.y-player.y));
ctx.fillStyle="#ff0000";
ctx.beginPath();ctx.arc(0,0,boss.size,0,Math.PI*2);ctx.fill();
ctx.restore();
}

}

/* =========================
   LOOP
========================= */

function loop(){
update();
draw();
requestAnimationFrame(loop);
}
loop();

</script>
</body>
</html>
